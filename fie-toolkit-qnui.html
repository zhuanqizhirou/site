<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-05-06 周一 18:10 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="stylesheets/site.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgbeb44c7">相关资料</a></li>
<li><a href="#org9c956af">项目下载安装,打包发布.</a>
<ul>
<li><a href="#orgf85e574">0.前提！important</a></li>
<li><a href="#org59e50b4">1.安装fie环境</a></li>
<li><a href="#orgcc581fe">【非必须，可参考】安装fie-toolkit-qnui 示例项目.</a></li>
<li><a href="#org876168a">2.SVN下载pc_qnui_source项目</a></li>
<li><a href="#org463a5d8">开发测试方法：</a>
<ul>
<li><a href="#org6c927be">IDE: webStorm，切记：Double Shift，Search Everywhere!</a></li>
</ul>
</li>
<li><a href="#org6ef821f">发布/部署到线上/测试环境</a></li>
</ul>
</li>
<li><a href="#org5d5e4ca">推荐本地使用Git管理代码</a>
<ul>
<li><a href="#orgfdce722">个人常用Git命令</a></li>
</ul>
</li>
<li><a href="#orgcced8c5">注意事项</a></li>
<li><a href="#org955ca8f">项目分析</a>
<ul>
<li><a href="#orgdfe1da2">Redux</a>
<ul>
<li><a href="#orgebfee4f">containers内容:</a>
<ul>
<li><a href="#org8f9a95f">ES6 模板字符串(自由打印示例)</a></li>
</ul>
</li>
<li><a href="#org9a35aa0">actions内容:</a></li>
<li><a href="#org01281ef">reducers</a>
<ul>
<li><a href="#org7423f12">/src/pages/root/reducers/index.js</a></li>
<li><a href="#orgff3ba03">/src/pages/root/reducers/print/index.js</a></li>
<li><a href="#org8fe411c">/src/pages/root/reducers/print/searchPrint.js</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org77b8d7e">基本开发流程</a>
<ul>
<li><a href="#orgf5e672d">从添加菜单开始到页面正常显示</a></li>
<li><a href="#orgb97576e">数据处理流程</a>
<ul>
<li><a href="#orga09aed7">Redux原理:</a></li>
<li><a href="#org2f0c953">1.事件触发（containers视图内）</a></li>
<li><a href="#org9f26fc6">2.动作处理（actions文件夹内）</a></li>
<li><a href="#org8de3b89">3.reducer处理（reducers文件夹内）</a></li>
<li><a href="#org2c82d1d">4.state变化后，自动更新视图内容</a>
<ul>
<li><a href="#orgd92242d">一般情况：</a></li>
<li><a href="#org63c6a9b">本例中，组件Form部分,统一更新表单数据</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org78b9bec">开发规范</a>
<ul>
<li><a href="#orgb115d7e">通用</a></li>
<li><a href="#org9b6337a">目录划分</a>
<ul>
<li><a href="#orgf5b661e">build/external</a></li>
<li><a href="#org1b910a9">src 目录</a></li>
</ul>
</li>
<li><a href="#orga9cbc5d">样式</a></li>
</ul>
</li>
<li><a href="#org797b34a">已解锁</a>
<ul>
<li><a href="#org6365e16">0.Double Shift,Search Everywhere。</a></li>
<li><a href="#org240b74d">1.新旧版切换,参照短信关怀&gt;短信群发,跳转到旧版,点击"to QNUI",返回新版.</a></li>
<li><a href="#org9bf35ac">2.webpack.config.js alias配置</a></li>
<li><a href="#org55ae342">3.图片资源使用url-loader</a>
<ul>
<li><a href="#org4728abf">准备</a></li>
<li><a href="#org4b9dba1">原理/配置项</a></li>
<li><a href="#org9c3e64d">应用</a></li>
</ul>
</li>
<li><a href="#orgce629ca"><span class="done DONE">DONE</span> 4.版本号自增</a></li>
<li><a href="#orgc2fad3a"><span class="done DONE">DONE</span> 5.动态路由功能</a></li>
<li><a href="#org2505dfd"><span class="todo TODO">TODO</span> 6.自动更新引用页中js，css版本</a></li>
<li><a href="#org6974acb"><span class="done DONE">DONE</span> 7.引用第三方js</a></li>
<li><a href="#org44e1710"><span class="done DONE">DONE</span> 8.原框架使用webpack1.2,升级至最新版3.4</a></li>
<li><a href="#org8ead8b5"><span class="done DONE">DONE</span> 9.sass/scss样式相关</a>
<ul>
<li><a href="#orga049c3b">禁止条例</a></li>
</ul>
</li>
<li><a href="#org7d4999c"><span class="done DONE">DONE</span> 10.根据窗口大小动态设置主页滚动条高度，避免顶级菜单右侧出现滚动条</a></li>
<li><a href="#org1debe24"><span class="done DONE">DONE</span> 11.使用lodash &amp; 只导出引用的方法。</a>
<ul>
<li><a href="#org4bf8b03">_.get(object, path, [defaultValue]) 避免多层取值时中间出现null或undefined</a></li>
<li><a href="#org1e61be7">_.cloneDeep(value) 深度克隆</a></li>
</ul>
</li>
<li><a href="#org6d0edf4"><span class="done DONE">DONE</span> 12. ！Important：使用_.get(object, path, [defaultValue]) 避免多层取值时出现null或undefined</a></li>
<li><a href="#org65903e0"><span class="done DONE">DONE</span> 13.开发阶段通过配置proxy实现ajax跨域</a></li>
<li><a href="#org3a80821"><span class="done DONE">DONE</span> 13-1[优化]只代理以/pc开头，action结尾的地址</a></li>
<li><a href="#orge890abb"><span class="done DONE">DONE</span> 14.state 结合classnames 控制className</a></li>
<li><a href="#org29ef621"><span class="done DONE">DONE</span> 15.获取ref="xx" 高度</a></li>
<li><a href="#org50b8dae"><span class="done DONE">DONE</span> 16.React Property initializers @author:薛念华</a></li>
<li><a href="#org836fb5b"><span class="done DONE">DONE</span> 17.React中key的重要性</a></li>
<li><a href="#org97ffaae"><span class="done DONE">DONE</span> 18.函数式编程 参考</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgbeb44c7" class="outline-2">
<h2 id="orgbeb44c7">相关资料</h2>
<div class="outline-text-2" id="text-orgbeb44c7">
<p>
1.<a href="http://qnui.taobao.org/start/getStart/index.html">千牛UI</a>组件库<br />
2.<a href="http://qnui.taobao.org/start/fie/">千牛UI推荐的脚手架fie-toolkit-qnui基本介绍</a><br />
3.<a href="https://github.com/fieteam/fie-toolkit-qnui">github:fie-toolkit-qnui</a><br />
4.<a href="https://github.com/fieteam/fie-toolkit-qnui">github:fie</a><br />
5.<a href="http://www.8dou5che.com/2017/01/22/react-router-redux/">react-router-redux 中文文档</a><br />
6.<a href="https://react-guide.github.io/react-router-cn/">react-router 中文文档</a><br />
7.<a href="https://doc.webpack-china.org/guides/getting-started/">webpack 起步</a><br />
8.<a href="http://iconfont.cn/collections/index?spm=a313x.7781069.1998910419.3&amp;type=1">IconFont</a><br />
9.<a href="https://lodash.com/docs/4.17.4">lodash 4.17.4</a> <a href="http://www.css88.com/doc/lodash/">lodash 4.16.1中文版</a><br />
10.<a href="https://developer.mozilla.org/zh-CN/docs/Web">Mozilla.org Web技术文档</a> <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript">Mozilla.org JavaScript</a><br />
</p>
</div>
</div>


<div id="outline-container-org9c956af" class="outline-2">
<h2 id="org9c956af">项目下载安装,打包发布.</h2>
<div class="outline-text-2" id="text-org9c956af">
</div>
<div id="outline-container-orgf85e574" class="outline-3">
<h3 id="orgf85e574">0.前提！important</h3>
<div class="outline-text-3" id="text-orgf85e574">
<p>
1.安装node<br />
2.为实现快速安装，不需要代理，避免执行npm i失败，可以使用cnpm代替npm。安装方法：<br />
npm i cnpm -g<br />
下面提到的所有npm 命令，可用cnpm代替。如npm i fie -g 替换为cnpm i fie -g<br />
npm i 为 npm install 简称。<br />
</p>
</div>
</div>
<div id="outline-container-org59e50b4" class="outline-3">
<h3 id="org59e50b4">1.安装fie环境</h3>
<div class="outline-text-3" id="text-org59e50b4">
<div class="org-src-container">
<pre class="src src-js">npm install fie -g --registry=https:<span style="color: #b22222;">//</span><span style="color: #b22222;">registry.npm.taobao.org</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcc581fe" class="outline-3">
<h3 id="orgcc581fe">【非必须，可参考】安装fie-toolkit-qnui 示例项目.</h3>
<div class="outline-text-3" id="text-orgcc581fe">
<p>
1.安装fie-toolkit-qnui<br />
</p>
<div class="org-src-container">
<pre class="src src-js">fie install toolkit-qnui
</pre>
</div>
<p>
2.初始化<br />
</p>
<pre class="example">
fie init qnui
</pre>
</div>
</div>

<div id="outline-container-org876168a" class="outline-3">
<h3 id="org876168a">2.SVN下载pc_qnui_source项目</h3>
<div class="outline-text-3" id="text-org876168a">
<p>
1.checkout pc_qnui_source文件夹,svn地址(xxxx修改成正确ip):<br />
</p>
<pre class="example">
https://xxxx/svn/qnpy_trade/qianniuPCWeb/WebRoot/pc_qnui_source
</pre>
<p>
2.安装modules<br />
</p>
<pre class="example">
npm i
</pre>
<p>
3.开发: webStorm terminal,或者cmd，或者Git Bash中执行:<br />
</p>
<div class="org-src-container">
<pre class="src src-js">fie start,&#21363;&#21487;&#36793;&#25913;&#36793;&#26597;&#30475;&#25928;&#26524;
</pre>
</div>
</div>
</div>
<div id="outline-container-org463a5d8" class="outline-3">
<h3 id="org463a5d8">开发测试方法：</h3>
<div class="outline-text-3" id="text-org463a5d8">
</div>
<div id="outline-container-org6c927be" class="outline-4">
<h4 id="org6c927be">IDE: webStorm，切记：Double Shift，Search Everywhere!</h4>
<div class="outline-text-4" id="text-org6c927be">
<p>
淘宝后台测试回调地址为 <a href="http://127.0.0.1:9000/pages/root.html">http://127.0.0.1:9000/pages/root.html</a>, 添加上自己的测试账号，本地fie start启动，保证端口9000未被占用，就可以在千牛中登录自己账号，点击普云交易，即可。<br />
F12，查看信息。<br />
</p>
</div>
</div>
</div>
<div id="outline-container-org6ef821f" class="outline-3">
<h3 id="org6ef821f">发布/部署到线上/测试环境</h3>
<div class="outline-text-3" id="text-org6ef821f">
<p>
fie.config.js中配置了要用的deploy命令,用于将需要deploy的目录复制到pc_qnui目录下.<br />
</p>

<div class="org-src-container">
<pre class="src src-js">fie build
</pre>
</div>
<div class="org-src-container">
<pre class="src src-js">fie deploy
</pre>
</div>
<p>
主要有三个目录:<br />
</p>
<pre class="example">
/build      build后主要内容
/pages      唯一的入口文件目录
/pc         拷贝的原pc目录, 用于新项目中新旧版互相访问,修改.旧版pc目录不动.
</pre>

<p>
此时 直接将pc_qnui文件夹中的内容覆盖到PC版WebRoot/pc_qnui文件夹中即可.<br />
此时可正常访问<br />
<a href="http://192.168.1.67:7001/pc_qnui/pages/root.html">http://192.168.1.67:7001/pc_qnui/pages/root.html</a><br />
</p>

<p>
/build/lib下同时包含两个版本js,可以只保留min版本.<br />
建议后期使用cdn.<br />
</p>
</div>
</div>
</div>

<div id="outline-container-org5d5e4ca" class="outline-2">
<h2 id="org5d5e4ca">推荐本地使用Git管理代码</h2>
<div class="outline-text-2" id="text-org5d5e4ca">
<p>
强烈建议本地使用Git管理版本,每次成功实现一个功能,及时commit. 否则bug查找起来不是那么容易.<br />
svn checkout, 先执行下面命令加入本地Git版本库.<br />
执行下面初始化命令时,会覆盖文件,可以使用Git命令恢复.<br />
</p>
<pre class="example">
git init
git add .
git commit -m 'first commit, checkout from SVN'
</pre>
</div>
<div id="outline-container-orgfdce722" class="outline-3">
<h3 id="orgfdce722">个人常用Git命令</h3>
<div class="outline-text-3" id="text-orgfdce722">
<pre class="example">
git brahch              # 查看分支
git checkout -b dev     # 创建并切换到dev分支
git checkout master     # 切换到默认master分支
git diff &lt;file&gt;         # 比较工作区与暂存区
git diff --ignore-space-change file     # 忽略空格
git diff --cached file  # 比较暂存区与版本库
git log --pretty=oneline #单行显示版本变更记录
git checkout -- file    # 版本库覆盖工作区内容
git reset 1111          # 文件不动,版本库指向1111
git reset --hard 1111         # 版本库1111内容强制覆盖本地内容, 慎用! untracked内容不会被覆盖
git rm  -r -n --cached   .svn/ #递归从版本库中删除.snv/目录
git clean -nf           ;;查看要删除的untracded files
git clean -nfd          ;;查看要删除的untracded files，以及目录
git clean -f            ;;执行删除
git clean -fd           ;;执行删除，以及目录




</pre>
</div>
</div>
</div>
<div id="outline-container-orgcced8c5" class="outline-2">
<h2 id="orgcced8c5">注意事项</h2>
<div class="outline-text-2" id="text-orgcced8c5">
<p>
1.pages/root.html<br />
</p>
<pre class="example">
1. 核心库文件
2. ../build/vender.js,              相对路径
3. ../build/pages/root/index.js     相对路径,编译后的主要文件,页面onload后加载.
3. ../build/pages/root/index.bundle.css     相对路径
</pre>
<p>
2./pages/js/common.js 与/src/utils/index.js中都有一个isLocal()方法,<br />
如果是127.0.0.1或localhost, 表示本地开发测试.<br />
其他为表示pc_qnui/目录下部署环境.<br />
</p>
</div>
</div>
<div id="outline-container-org955ca8f" class="outline-2">
<h2 id="org955ca8f">项目分析</h2>
<div class="outline-text-2" id="text-org955ca8f">
</div>
<div id="outline-container-orgdfe1da2" class="outline-3">
<h3 id="orgdfe1da2">Redux</h3>
<div class="outline-text-3" id="text-orgdfe1da2">
<p>
核心思路是将各种组件的State统一到store中,在各个组件内使用this.props.xxx引用,形成真正的无生命周期纯UI组件,只需要render()方法.<br />
主要涉及三处:<br />
</p>
<pre class="example">
/src/pages/root/actions
/src/pages/root/reducers
/src/pages/root/containers/ 下各个页面Component.

</pre>
<p>
以打单发货&gt;查询补打页面为例.点击按钮,<br />
</p>
</div>
<div id="outline-container-orgebfee4f" class="outline-4">
<h4 id="orgebfee4f">containers内容:</h4>
<div class="outline-text-4" id="text-orgebfee4f">
<p>
/src/containers/print/freePrint/con_searchPrint.js<br />
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> * as actions from <span style="color: #8b2252;">'../../../actions/print/searchPrint'</span>;

<span style="color: #a020f0;">class</span> SearchPrint <span style="color: #a020f0;">extends</span> React.Component {
    handleClick() {
        <span style="color: #a020f0;">var</span> {dispatch, searchPrint} = <span style="color: #008b8b;">this</span>.props;
        dispatch(actions.getList(searchPrint.counter + 1));
    }
}
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> connect((state) =&gt; {
    <span style="color: #a020f0;">return</span> {
        searchPrint: state.print.searchPrint,
    };
})(SearchPrint);
</pre>
</div>
<p>
state.print.searchPrint,其中print对应reducers/index.js中print,<br />
print.searchPrint对应reducers/print/index.js中的searchPrint,即 reducers/print/searchPrint.js<br />
</p>
</div>
<div id="outline-container-org8f9a95f" class="outline-5">
<h5 id="org8f9a95f">ES6 模板字符串(自由打印示例)</h5>
<div class="outline-text-5" id="text-org8f9a95f">
<div class="org-src-container">
<pre class="src src-js"><span style="color: #8b2252;">`&#25991;&#26412; ${variable} &#25991;&#26412;`</span>
</pre>
</div>
<p>
`, 反引号不是单引号'<br />
</p>
</div>
</div>
</div>

<div id="outline-container-org9a35aa0" class="outline-4">
<h4 id="org9a35aa0">actions内容:</h4>
<div class="outline-text-4" id="text-org9a35aa0">
<p>
/src/pages/root/actions/print/searchPrint.js<br />
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #8b2252;">'use strict'</span>;

<span style="color: #a020f0;">import</span> {ajax, nameSpace} from <span style="color: #8b2252;">'../../../../utils/index'</span>;

<span style="color: #a020f0;">let</span> <span style="color: #a0522d;">ns</span> = nameSpace(<span style="color: #8b2252;">'print-searchPrint'</span>);
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">GET_LIST_REQUEST</span> = ns(<span style="color: #8b2252;">'GET_LIST_REQUEST'</span>); <span style="color: #b22222;">//</span><span style="color: #b22222;">"print-searchPrint-GET_LIST_REQUEST"</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">GET_LIST_SUCCESS</span> = ns(<span style="color: #8b2252;">'GET_LIST_SUCCESS'</span>);
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">GET_LIST_FAILED</span> = ns(<span style="color: #8b2252;">'GET_LIST_FAILED'</span>);

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">function</span> getList(<span style="color: #a0522d;">data</span>) {

    <span style="color: #a020f0;">return</span> (dispatch) =&gt; {

        <span style="color: #b22222;">//</span><span style="color: #b22222;">&#21457;&#36865;&#35831;&#27714;&#21069;</span>
        dispatch({
            type: GET_LIST_REQUEST,
            data: data
        });

        <span style="color: #b22222;">//</span><span style="color: #b22222;">&#25509;&#25910;&#21040;&#25968;&#25454;</span>
        ajax({
            api: <span style="color: #8b2252;">'page2List'</span>,
            method: <span style="color: #8b2252;">'GET'</span>,
        }).then(json =&gt; {
            <span style="color: #b22222;">//</span><span style="color: #b22222;">&#25104;&#21151;&#21518;</span>
            dispatch({
                type: GET_LIST_SUCCESS,
                data: json.data
            });

        }, json =&gt; {
            <span style="color: #b22222;">//</span><span style="color: #b22222;">&#22833;&#36133;&#21518;</span>
            dispatch({
                type: GET_LIST_FAILED,
                data: json
            });

        });

    };
}

</pre>
</div>
</div>
</div>
<div id="outline-container-org01281ef" class="outline-4">
<h4 id="org01281ef">reducers</h4>
<div class="outline-text-4" id="text-org01281ef">
</div>
<div id="outline-container-org7423f12" class="outline-5">
<h5 id="org7423f12">/src/pages/root/reducers/index.js</h5>
<div class="outline-text-5" id="text-org7423f12">
<div class="org-src-container">
<pre class="src src-js"><span style="color: #8b2252;">'use strict'</span>;

<span style="color: #a020f0;">import</span> { combineReducers } from <span style="color: #8b2252;">'redux'</span>;
<span style="color: #a020f0;">import</span> { routerReducer } from <span style="color: #8b2252;">'react-router-redux'</span>;
<span style="color: #a020f0;">import</span> print from <span style="color: #8b2252;">'./print/'</span>;
<span style="color: #a020f0;">import</span> trade from <span style="color: #8b2252;">'./trade/'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#29616;&#26377;&#30340;reduces&#21152;&#19978;&#36335;&#30001;&#30340;reducer</span>
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">rootReducer</span> = combineReducers({
  trade,
  print,
  routing: routerReducer
});

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> rootReducer;

</pre>
</div>
</div>
</div>
<div id="outline-container-orgff3ba03" class="outline-5">
<h5 id="orgff3ba03">/src/pages/root/reducers/print/index.js</h5>
<div class="outline-text-5" id="text-orgff3ba03">
<div class="org-src-container">
<pre class="src src-js"><span style="color: #8b2252;">'use strict'</span>;

<span style="color: #a020f0;">import</span> { combineReducers } from <span style="color: #8b2252;">'redux'</span>;
<span style="color: #a020f0;">import</span> { routerReducer } from <span style="color: #8b2252;">'react-router-redux'</span>;
<span style="color: #a020f0;">import</span> freePrint from <span style="color: #8b2252;">'./freePrint'</span>;
<span style="color: #a020f0;">import</span> searchPrint from <span style="color: #8b2252;">'./searchPrint'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#29616;&#26377;&#30340;reduces&#21152;&#19978;&#36335;&#30001;&#30340;reducer</span>
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">rootReducer</span> = combineReducers({
    freePrint,
    searchPrint,
    routing: routerReducer
});

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> rootReducer;
</pre>
</div>
</div>
</div>
<div id="outline-container-org8fe411c" class="outline-5">
<h5 id="org8fe411c">/src/pages/root/reducers/print/searchPrint.js</h5>
<div class="outline-text-5" id="text-org8fe411c">
<div class="org-src-container">
<pre class="src src-js"><span style="color: #8b2252;">'use strict'</span>;

<span style="color: #a020f0;">import</span> * as actions from <span style="color: #8b2252;">'../../actions/print/searchPrint'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#23545;&#39029;&#38754;prop &#25968;&#25454;&#36827;&#34892;&#31649;&#29702;</span>
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">initialState</span> = {
    list: [],
    listLoading: <span style="color: #008b8b;">false</span>,
    counter: 0
};
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">defaultAction</span> = {
    type: <span style="color: #8b2252;">'doNothing'</span>
};

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">function</span> index(<span style="color: #a0522d;">state</span> = <span style="color: #a0522d;">initialState</span>, <span style="color: #a0522d;">action</span> = <span style="color: #a0522d;">defaultAction</span>) {
    <span style="color: #a020f0;">switch</span> (action.type) {

        <span style="color: #a020f0;">case</span> actions.GET_LIST_REQUEST:

            <span style="color: #a020f0;">return</span> Object.assign({}, state, {
                listLoading: <span style="color: #008b8b;">true</span>,
                counter: action.data
            });

        <span style="color: #a020f0;">case</span> actions.GET_LIST_SUCCESS:

            <span style="color: #a020f0;">return</span> Object.assign({}, state, {
                listLoading: <span style="color: #008b8b;">false</span>,
                list: action.data.list.map(item =&gt; {
                    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">`&#31532;${state.counter}&#27425;&#21152;&#36733;&#65306;${item}`</span>;
                })
            });

        <span style="color: #a020f0;">case</span> actions.GET_LIST_FAILED:

            <span style="color: #a020f0;">return</span> Object.assign({}, state, {
                listLoading: <span style="color: #008b8b;">false</span>
            });

        <span style="color: #a020f0;">default</span>:
            <span style="color: #a020f0;">return</span> state;
    }
}

</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org77b8d7e" class="outline-2">
<h2 id="org77b8d7e">基本开发流程</h2>
<div class="outline-text-2" id="text-org77b8d7e">
</div>
<div id="outline-container-orgf5e672d" class="outline-3">
<h3 id="orgf5e672d">从添加菜单开始到页面正常显示</h3>
<div class="outline-text-3" id="text-orgf5e672d">
<p>
也可作为拍错检查步骤.再次建议,本地使用Git管理,与svn不冲突,将.git添加到svn ignore(recursively)中.<br />
.gitignore中已添加*.svn/<br />
下面是打单发货下面添加物流动态菜单的步骤,物流动态包括交易物流动态和高级物流查询.<br />
</p>

<p>
1.src/layout/rootHeader中添加菜单<br />
2.src/pages/root/routes.js 中配置路由与组件对应关系<br />
</p>
<pre class="example">
1.引用组件
2.配置路由组件对应关系
</pre>
<p>
3.src/pages/root/containers 添加组件<br />
</p>
<div class="org-src-container">
<pre class="src src-js">
1.&#36890;&#24120;&#19968;&#20010;&#32452;&#20214;&#19968;&#20010;&#30446;&#24405;,&#21253;&#21547;&#19968;&#20010;js&#19982;&#19968;&#20010;scss&#25991;&#20214;.&#25152;&#20197;&#30452;&#25509;&#22797;&#21046;&#21516;&#32423;/&#19978;&#32423;&#19968;&#20010;&#32452;&#20214;,
2.&#20462;&#25913;&#25991;&#20214;&#22841;&#21517;&#31216;,js&#21517;&#31216;,&#19981;&#24314;&#35758;&#29992;&#40664;&#35748;&#30340;index,&#21542;&#21017;&#35843;&#35797;&#26102;&#20840;&#26159;index.
3.js&#20013;&#31867;&#21517;,&#20197;&#21450;export&#20013;&#31867;&#21517;&#19982;state...&#36335;&#24452;, &#20197;&#21450;&#24341;&#29992;&#30340;&#22320;&#26041;
&#22914;:
<span style="color: #a020f0;">class</span> PrintLogisticsStatus <span style="color: #a020f0;">extends</span> React.Component { <span style="color: #b22222;">//</span><span style="color: #b22222;">PrintLogisticsStatus &#31867;&#21517;</span>
    handleClick() {
        <span style="color: #a020f0;">var</span> {dispatch, printLogisticsStatus} = <span style="color: #008b8b;">this</span>.props; <span style="color: #b22222;">// </span><span style="color: #b22222;">printLogisticsStatus</span>
        dispatch(actions.addText(<span style="color: #8b2252;">`&#25991;&#26412;${printLogisticsStatus.list.length + 1}`</span>)); <span style="color: #b22222;">//</span><span style="color: #b22222;">printLogisticsStatus</span>
    }
}
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> connect((state) =&gt; {
    <span style="color: #a020f0;">return</span> {
        printLogisticsStatus: state.print.logistics.status,<span style="color: #b22222;">//</span><span style="color: #b22222;">printLogisticsStatus,&#20197;&#21450;state&#21518;&#38754;&#30340;</span>
    };
})(PrintLogisticsStatus);<span style="color: #b22222;">//</span><span style="color: #b22222;">&#31867;&#21517;</span>


4.js&#20013;&#25991;&#20214;&#24320;&#22836;&#30340;&#30456;&#23545;&#36335;&#24452;(../).&#25353;&#20303;Ctrl&#28857;&#20987;&#36335;&#24452;&#26411;&#23614;,&#22914;&#26524;&#19981;&#21464;&#34013;&#21017;&#20026;&#26080;&#25928;&#36335;&#24452;.
5.js&#25991;&#20214;&#24320;&#22836;&#30340;actions&#36335;&#24452;&#21517;&#31216;
</pre>
</div>
<p>
4.src/pages/root/actions增加对应目录文件,<br />
</p>
<pre class="example">
1,修改import 相对路径
2.修改 let ns = nameSpace('print-searchPrint');为 - 间隔的对应路径
</pre>
<p>
5.src/pages/root/reducers/下维护对应的目录文件,引用关系.注意是到文件夹还是文件夹里面对应的js.<br />
</p>
<pre class="example">
1.修改相对路径与文件: import * as actions from '../../../actions/print/logistics/status';
2. 
</pre>
<p>
6.Contain组件内容,action与reducers中具体业务逻辑<br />
</p>
</div>
</div>

<div id="outline-container-orgb97576e" class="outline-3">
<h3 id="orgb97576e">数据处理流程</h3>
<div class="outline-text-3" id="text-orgb97576e">
</div>
<div id="outline-container-orga09aed7" class="outline-4">
<h4 id="orga09aed7">Redux原理:</h4>
<div class="outline-text-4" id="text-orga09aed7">
<p>
通过containers中&lt;RateDefendSate/&gt;组件中最后一段的定义，set与state，会作为props传递给组件。<br />
组件内就可以通过this.props.set,this.props.state引用里面保存的数据。<br />
基于React原生组件规则，state,与props变化，对应render()方法中引用部分会自动更新。所以这里reducers里面改变了state，页面自动更新。<br />
</p>
<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> connect((state) =&gt; {
    <span style="color: #a020f0;">return</span> {
        set: state.rate.defend.set,<span style="color: #b22222;">//</span><span style="color: #b22222;">&#36820;&#22238;&#24403;&#21069;&#32452;&#20214;&#33258;&#24049;&#30340;state&#65292;&#23646;&#24615;&#21517;&#38543;&#20415;&#23450;&#20041;&#65292;&#32452;&#20214;&#20869;&#32479;&#19968;&#29992;&#23427;&#20195;&#34920;&#36890;&#24120;&#32452;&#20214;&#33258;&#24049;&#30340;state&#65292;&#23646;&#24615;&#20540;&#26368;&#21518;&#30340;set&#65292;&#21017;&#26159;reducers&#25991;&#20214;&#22841;&#20869;&#23618;&#23618;&#37197;&#32622;&#30340;.</span>
        state: state,<span style="color: #b22222;">//</span><span style="color: #b22222;">&#20063;&#21487;&#20197;&#36820;&#22238;&#20854;&#20182;&#23618;&#27425;&#30340;state.</span>
    };
})(RateDefendSet);
</pre>
</div>

<p>
示例：评价管理》差评师防御》设置页面，页面显示自动请求数据，立即显示加载中旋转的蓝色图标，三秒后获取到数据，更新最上面switch，隐藏加载中图标。<br />
</p>
</div>
</div>
<div id="outline-container-org2f0c953" class="outline-4">
<h4 id="org2f0c953">1.事件触发（containers视图内）</h4>
<div class="outline-text-4" id="text-org2f0c953">
<div class="org-src-container">
<pre class="src src-javascript">src/pages/root/containers/rate/defend/set/reteDefendSet.js
&#19968;&#33324;&#26159;&#20107;&#20214;&#35302;&#21457;&#65292;&#36825;&#37324;&#26159;&#25171;&#24320;&#39029;&#38754;&#25191;&#34892;&#33719;&#21462;&#25968;&#25454;&#21160;&#20316;&#12290;
<span style="color: #008b8b;">this</span>.props.dispatch(actions.loadData());
</pre>
</div>
</div>
</div>
<div id="outline-container-org9f26fc6" class="outline-4">
<h4 id="org9f26fc6">2.动作处理（actions文件夹内）</h4>
<div class="outline-text-4" id="text-org9f26fc6">
<p>
一般是调用service层接口，service层调用api获取数据，这里用ajax示例。<br />
成功后，执行dispatch(action).<br />
action对象只有2个属性：<br />
    type:字符串，表示动作<br />
    data:对象，需要更新的数据<br />
</p>
<div class="org-src-container">
<pre class="src src-javascript">src/pages/root/actions/rate/defend/set.js
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">function</span> loadData() {
    <span style="color: #a020f0;">return</span> (dispatch) =&gt; {
        <span style="color: #b22222;">//</span><span style="color: #b22222;">&#21457;&#36865;&#35831;&#27714;&#21069;</span>
        dispatch({
            type: BEFORE_REQUEST,<span style="color: #b22222;">//</span><span style="color: #b22222;">&#21482;&#26159;&#35774;&#32622;state&#20013;loading&#20026;true&#65292;&#26174;&#31034;Loading&#32452;&#20214;&#12290;</span>
        });
        <span style="color: #b22222;">//</span><span style="color: #b22222;">&#25509;&#25910;&#21040;&#25968;&#25454;</span>
        ajax({
            api: <span style="color: #8b2252;">'loadSet'</span>,
            method: <span style="color: #8b2252;">'GET'</span>,
        }).then(json =&gt; {
            <span style="color: #b22222;">//</span><span style="color: #b22222;">&#25104;&#21151;&#21518;</span>
            setTimeout(() =&gt; {
                dispatch({
                    type: REQUEST_SUCCESS,
                    data: json.data
                });
            }, 3000)<span style="color: #b22222;">//</span><span style="color: #b22222;">&#27169;&#25311;&#25968;&#25454;&#21152;&#36733;&#12289;&#22788;&#29702;3&#31186;&#65292;&#19978;&#19968;&#27493;dispatch&#26356;&#26032;state&#21518;&#39029;&#38754;&#26681;&#25454;state&#26174;&#31034;Loading&#32452;&#20214;&#65292;&#20043;&#21518;&#26356;&#26032;state&#65292;&#38544;&#34255;Loading&#65292;&#26356;&#26032;&#25968;&#25454;&#26174;&#31034;&#12290;</span>

        }, json =&gt; {
            <span style="color: #b22222;">//</span><span style="color: #b22222;">&#22833;&#36133;&#21518;</span>
            dispatch({
                type: REQUEST_FAILED,
                data: json
            });

        });
    }
}
</pre>
</div>
<p>
基本流程是页面内或路由里面通过<br />
this.props.disptach(actions.xxx())<br />
,<br />
actions里面xxx方法调用service层获取并处理数据，service调用api获取数据<br />
actions根据处理情况调用<br />
dispatch({<br />
                type: REQUEST_SUCCESS,<br />
                data: json.data<br />
            });<br />
,交给reducers更新state。<br />
</p>
</div>
</div>
<div id="outline-container-org8de3b89" class="outline-4">
<h4 id="org8de3b89">3.reducer处理（reducers文件夹内）</h4>
<div class="outline-text-4" id="text-org8de3b89">
<p>
主要就是根据action.type, 将action.data更新到state中<br />
</p>
<div class="org-src-container">
<pre class="src src-javascript">src/pages/root/reducers/rate/defend/set/index.js
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">function</span> index(<span style="color: #a0522d;">state</span> = <span style="color: #a0522d;">initialState</span>, <span style="color: #a0522d;">action</span> = <span style="color: #a0522d;">defaultAction</span>) {
    <span style="color: #a020f0;">switch</span> (action.type) {
        <span style="color: #a020f0;">case</span> actions.BEFORE_REQUEST:<span style="color: #b22222;">//</span><span style="color: #b22222;">&#25968;&#25454;&#35831;&#27714;&#24320;&#22987;&#65292;&#35774;&#32622;loading&#20026;true&#65292;&#26174;&#31034;Loading&#32452;&#20214;</span>
            <span style="color: #a020f0;">return</span> Object.assign({}, state, {
                loading: <span style="color: #008b8b;">true</span>,
            });

        <span style="color: #a020f0;">case</span> actions.REQUEST_SUCCESS:<span style="color: #b22222;">//</span><span style="color: #b22222;">&#25968;&#25454;&#21152;&#36733;&#25104;&#21151;&#65292;&#26356;&#26032;&#25968;&#25454; </span>
            <span style="color: #a020f0;">return</span> Object.assign({}, state, {
                loading: <span style="color: #008b8b;">false</span>,
                formData: action.data
            });

        <span style="color: #a020f0;">case</span> actions.REQUEST_FAILED:<span style="color: #b22222;">//</span><span style="color: #b22222;">&#25968;&#25454;&#21152;&#36733;&#22833;&#36133;&#65292;&#35774;&#32622;loading&#20026;false&#65292;&#38544;&#34255;Loading&#32452;&#20214;&#12290;</span>
            <span style="color: #a020f0;">return</span> Object.assign({}, state, {
                loading: <span style="color: #008b8b;">false</span>,
            });

        <span style="color: #a020f0;">default</span>:
            <span style="color: #a020f0;">return</span> state;
    }
}

</pre>
</div>
</div>
</div>
<div id="outline-container-org2c82d1d" class="outline-4">
<h4 id="org2c82d1d">4.state变化后，自动更新视图内容</h4>
<div class="outline-text-4" id="text-org2c82d1d">
</div>
<div id="outline-container-orgd92242d" class="outline-5">
<h5 id="orgd92242d">一般情况：</h5>
<div class="outline-text-5" id="text-orgd92242d">
<p>
页面组件，&lt;Loading show={this.props.set.loading}/&gt;，set作为props传递给&lt;RateDefendSate&gt;组件，则上面第三部reducers中更新state设置loading为true，则显示加载中。三秒后无论成功失败，loading为false，自动隐藏。<br />
</p>
</div>
</div>
<div id="outline-container-org63c6a9b" class="outline-5">
<h5 id="org63c6a9b">本例中，组件Form部分,统一更新表单数据</h5>
<div class="outline-text-5" id="text-org63c6a9b">
<p>
和上面一样,set 更新,即this.props更新,会触发生命周期函数componentWillReceiveProps(nextProps)方法.<br />
通过nextProps.set.xxx 可以获取最新数据.其余是组件的用法,不再赘述.<br />
</p>
<div class="org-src-container">
<pre class="src src-javascript">componentWillReceiveProps(nextProps) {
    console.log(<span style="color: #8b2252;">`componentWillReceiveProps.formData:`</span>, nextProps.set.formData)
    <span style="color: #008b8b;">this</span>.field.setValues(nextProps.set.formData);
    console.log(<span style="color: #8b2252;">"lasttime:"</span>, nextProps.set.formData.lastTime)
}
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org78b9bec" class="outline-2">
<h2 id="org78b9bec">开发规范</h2>
<div class="outline-text-2" id="text-org78b9bec">
</div>
<div id="outline-container-orgb115d7e" class="outline-3">
<h3 id="orgb115d7e">通用</h3>
<div class="outline-text-3" id="text-orgb115d7e">
<p>
0.提交之前,或者本地commit之前,一定格式化代码!!! line separators(换行符)统一使用LF，已在.editconfig中定义。<br />
1.containers,actions,reducers路径与菜单路径保存一致.<br />
2.虽然webpack.config.js中设置了alias，但还是建议使用相对路径查找吧。如reducers中使用actions，可以有编辑器提示。而用别名，则没有。<br />
</p>
</div>
</div>
<div id="outline-container-org9b6337a" class="outline-3">
<h3 id="org9b6337a">目录划分</h3>
<div class="outline-text-3" id="text-org9b6337a">
</div>
<div id="outline-container-orgf5b661e" class="outline-4">
<h4 id="orgf5b661e">build/external</h4>
<div class="outline-text-4" id="text-orgf5b661e">
<p>
放置需要在页面中引用的额外的js文件。jquery仅示范，原则上不建议使用jquery，积极使用QNUI组件丰富功能。<br />
</p>
</div>
</div>
<div id="outline-container-org1b910a9" class="outline-4">
<h4 id="org1b910a9">src 目录</h4>
<div class="outline-text-4" id="text-org1b910a9">
<pre class="example">
|-- components                      通用组件
|   |-- Common
|   |-- DialogModifyPrice               原供应商PC版内容，仅供参考，现在页面内容不要放在这里。
|   |-- DialogRate                      同上
|   |-- DialogSendGoods                 同上
|   |-- DialogViewLogistics             同上
|   |-- Loading                         加载中，可优化
|   |-- Logistics                       原供应商PC版内容，仅供参考，现在页面内容不要放在这里。
|   |-- OrderItem                       原供应商PC版内容，列表Order中子订单组件
|   |-- Rate                            原供应商PC版内容，仅供参考，现在页面内容不要放在这里。
|   |-- Star5                           五星好评
|   |-- Toast                           自己制作的toast，
|   |-- order                           原供应商PC版内容，列表Order组件
|   `-- orderSearch
|-- data_api                        数据API
|   |-- aliapi.js                       供应商PC版的示例，不要用
|   |-- api.js                          调用淘宝接口api
|   |-- cache.js                        cache相关接口
|   `-- server.js                       调用后台接口api
|-- data_service                    service层
|   `-- CommonService.js                示例而已，不适合放在一个文件内，建议还是按照菜单划分，一个二级菜单（现在一般是一个人负责一个二级菜单）一个。
|-- layout                          页面总框架
|   |-- commonHeader                    菜单内部横向菜单，通用，如不同订单状态
|   |-- rootHeader                      主菜单
|   `-- rootLayout                      主页面内容
|-- pages                                   
|   `-- root                        对应pages/root.html
|       |-- actions                     redux 动作文件夹
|       |-- containers                  主要view视图
|       |-- index.js                    主要入口
|       |-- index.scss                  主要入口的样式文件
|       |-- reducers                    redux reducers内容，action中dispatch后从这里更新state
|       |-- routes.js                   路由文件入口
|       |-- routes_print.js         
|       |-- routes_rate.js
|       |-- routes_rate_defend.js
|       |-- routes_trade.js
|       `-- store                   store内容，暂不需要变动
|-- static                          可以放公共图片，使用url-loader模式处理，参考/layout/rootHeader中logo使用方式
|-- styles                          样式文件夹
|   |-- _var.scss                       统一使用的变量，如色块。使用色值一定引用此文件，参考《已解锁.9》
|   |-- common.scss                     通用样式，
|   `-- theme.scss                      更改qnui样式时修改。
`-- utils                           通用工具
    |-- apimap.js
    |-- common.js                       通用js工具放在这里
    |-- config.js                       通用配置
    |-- consts.js                       通用常量，如订单状态
    `-- index.js                        框架自带，已经有一些工具方法
</pre>
</div>
</div>
</div>
<div id="outline-container-orga9cbc5d" class="outline-3">
<h3 id="orga9cbc5d">样式</h3>
<div class="outline-text-3" id="text-orga9cbc5d">
<p>
0.样式尽量定义在当前页面render()方法最外层div类里面，否则自己的样式容易与qnui冲突，<br />
1.凡是scss文件顶层的样式，会作用于所有页面。所以，自己的样式，一定放在方法顶层div样式内.className按照菜单路径逐级，避免重复。<br />
2.顶层（rootLayout ）z-index设为了200，顶层菜单（rootHeader）设为了100，各页面大家用100以内<br />
5.可通过添加className的方式，改变默认qnui样式。<br />
如&lt;RadioGroup&gt;默认各选项连在一起，可通过F12查看class name,然后再自定义一个className样式。如：<br />
</p>
<div class="org-src-container">
<pre class="src src-css"><span style="color: #0000ff;">&lt;RadioGroup shape=</span><span style="color: #8b2252;">"button"</span><span style="color: #0000ff;"> size=</span><span style="color: #8b2252;">"medium"</span><span style="color: #0000ff;"> onChange=</span>{this.onConditionChange}&gt;
    <span style="color: #0000ff;">&lt;Radio className=</span><span style="color: #8b2252;">"rowElement"</span><span style="color: #0000ff;"> id=</span><span style="color: #8b2252;">"banana"</span><span style="color: #0000ff;"> value=</span><span style="color: #8b2252;">"banana"</span><span style="color: #0000ff;">&gt;&#23485;&#26494;&#26465;&#20214;&lt;/Radio&gt;</span>
<span style="color: #0000ff;">    &lt;Radio className=</span><span style="color: #8b2252;">"rowElement"</span><span style="color: #0000ff;"> id=</span><span style="color: #8b2252;">"watermelon"</span><span style="color: #0000ff;"> value=</span><span style="color: #8b2252;">"watermelon"</span><span style="color: #0000ff;">&gt;&#36866;&#20013;&#26465;&#20214;&lt;/Radio&gt;</span>
<span style="color: #0000ff;">    &lt;Radio className=</span><span style="color: #8b2252;">"rowElement"</span><span style="color: #0000ff;"> id=</span><span style="color: #8b2252;">"peach"</span><span style="color: #0000ff;"> value=</span><span style="color: #8b2252;">"peach"</span><span style="color: #0000ff;">&gt;&#20005;&#26684;&#26465;&#20214;&lt;/Radio&gt;</span>
<span style="color: #0000ff;">&lt;/RadioGroup&gt;</span>

<span style="color: #0000ff;">//radio-group &#21152;&#38388;&#36317;</span>
<span style="color: #0000ff;">.next-radio-wrapper.rowElement </span>{
    <span style="color: #a020f0;">margin-right</span>: 12px;
}
</pre>
</div>
<p>
其他：参照最新《已解锁.9》<br />
</p>
</div>
</div>
</div>

<div id="outline-container-org797b34a" class="outline-2">
<h2 id="org797b34a">已解锁</h2>
<div class="outline-text-2" id="text-org797b34a">
</div>
<div id="outline-container-org6365e16" class="outline-3">
<h3 id="org6365e16">0.Double Shift,Search Everywhere。</h3>
<div class="outline-text-3" id="text-org6365e16">
<p>
如Double shift, containers/rate/defend/,自动定位到对应文件夹。文件更是如此。<br />
</p>
</div>
</div>
<div id="outline-container-org240b74d" class="outline-3">
<h3 id="org240b74d">1.新旧版切换,参照短信关怀&gt;短信群发,跳转到旧版,点击"to QNUI",返回新版.</h3>
</div>
<div id="outline-container-org9bf35ac" class="outline-3">
<h3 id="org9bf35ac">2.webpack.config.js alias配置</h3>
<div class="outline-text-3" id="text-org9bf35ac">
<p>
alias中配置layout等,就可以直接import CommonHeader from "layout/commonHeader",不需要一级级../查找.<br />
缺点:不能按住Ctrl键高亮确定是否引用正确; 编辑器无法快捷提示。<br />
</p>

<pre class="example">
--- a/src/pages/root/containers/print/logistics/printLogistics.js
+++ b/src/pages/root/containers/print/logistics/printLogistics.js
@@ -6,7 +6,7 @@ import * as actions from '../../../actions/print/printLogistics';
 import {Button} from 'qnui';
 import './index.scss';
 import CONFIG from "../../../../../utils/config";
-import CommonHeader from '../../../../../layout/commonHeader'
+import CommonHeader from 'layout/commonHeader';

 class PrintLogistics extends React.Component {
     constructor(props) {
diff --git a/webpack.config.js b/webpack.config.js
index 4320202..3ca870d 100644
--- a/webpack.config.js
+++ b/webpack.config.js
@@ -36,6 +36,7 @@ var config = {
     extensions: ['', '.js', '.jsx'],
     alias: {
       components: path.join(__dirname, 'src/components'),
+      layout: path.join(__dirname, 'src/layout'),
       utils: path.join(__dirname, 'src/utils'),
       styles: path.join(__dirname, 'src/styles'),
       pages: path.join(__dirname, 'src/pages')
warning: LF will be replaced by CRLF in webpack.config.js.
The file will have its original line endings in your working directory.

</pre>
</div>
</div>
<div id="outline-container-org55ae342" class="outline-3">
<h3 id="org55ae342">3.图片资源使用url-loader</h3>
<div class="outline-text-3" id="text-org55ae342">
</div>
<div id="outline-container-org4728abf" class="outline-4">
<h4 id="org4728abf">准备</h4>
<div class="outline-text-4" id="text-org4728abf">
<p>
删除了/pc_qnui_source/images目录，将可能公用的图片存放在/pc_qnui_source/src/static目录下，或者与组件高度相关的直接放在组件文件夹内，多图可再建imgs子文件夹。<br />
使用url-loader,图片小于10k直接转为编码，减少网络请求，保持组件完整性。<br />
</p>

<p>
首先更新package.json后直接执行下面命令，安装url-loader：<br />
</p>
<pre class="example">
npm install
</pre>
</div>
</div>
<div id="outline-container-org4b9dba1" class="outline-4">
<h4 id="org4b9dba1">原理/配置项</h4>
<div class="outline-text-4" id="text-org4b9dba1">
<pre class="example">
webpack.config.js
{
                test: /\.(jpg|jpe?g|png|gif|svg)$/,
                loader: 'url-loader?limit=8096&amp;name=/images/[hash].[ext]',
                exclude: /node_modules/,
                include: path.resolve(__dirname, 'src')
}
</pre>
</div>
</div>
<div id="outline-container-org9c3e64d" class="outline-4">
<h4 id="org9c3e64d">应用</h4>
<div class="outline-text-4" id="text-org9c3e64d">
<p>
以/src/layout/rootHeader/index.js中logo为例。<br />
</p>

<p>
引用：<br />
</p>
<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #a020f0;">import</span> logo from <span style="color: #8b2252;">'./imgs/logo.png'</span>;
</pre>
</div>
<p>
使用：<br />
</p>
<div class="org-src-container">
<pre class="src src-javascript">&lt;img src={logo}/&gt;
</pre>
</div>
<p>
可能公用的图片，放在/src/static目录下。<br />
</p>
</div>
</div>
</div>
<div id="outline-container-orgce629ca" class="outline-3">
<h3 id="orgce629ca"><span class="done DONE">DONE</span> 4.版本号自增</h3>
<div class="outline-text-3" id="text-orgce629ca">
<p>
/version.txt保存了格式为1.00.010的当前版本信息。<br />
执行fie build,会自动取改版本信息并+1，自动将生产的css,js文件后缀加入该版本信息。<br />
逻辑位于versionControl.js与webpack.config.js中//=====版本号控制======================及VERSION字段相关部分。<br />
</p>
</div>
</div>

<div id="outline-container-orgc2fad3a" class="outline-3">
<h3 id="orgc2fad3a"><span class="done DONE">DONE</span> 5.动态路由功能</h3>
<div class="outline-text-3" id="text-orgc2fad3a">
<p>
1.配置webpack.config.js,主要是chunkFilename:[name].chunk.js<br />
</p>
<pre class="example">

output: {
        //DEV==1,开发环境，不用hash值； 非开发环境下（如执行fie build），使build文件含hash前5位
        path: 'build',
        publicPath: DEV == 1 ? '/build' : '../build',
        filename: DEV == 1 ? '[name].js' : '[name]-' + VERSION + '.js',
        chunkFilename: DEV == 1 ? '/[name].chunk.js' : '/[name].chunk-' + VERSION + '.js'
    },
</pre>
<p>
2.配置route,如按主菜单分，<br />
</p>
<div class="org-src-container">
<pre class="src src-javascript">&lt;Route path={<span style="color: #8b2252;">"/"</span>}
           component={RootLayout}
           getChildRoutes={(location, cb) =&gt; {
               console.log(location);
               <span style="color: #a020f0;">if</span> (location.pathname.indexOf(<span style="color: #8b2252;">"/trade"</span>) == 0) {
                   require.ensure([], require =&gt; {
                       console.log(location);
                       cb(<span style="color: #008b8b;">null</span>, require(<span style="color: #8b2252;">'./routes_trade'</span>).<span style="color: #a020f0;">default</span>);
                   }, <span style="color: #8b2252;">"routes_trade"</span>)
               }
               <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> (location.pathname.indexOf(<span style="color: #8b2252;">"/rate"</span>) == 0) {
                       require.ensure([], require =&gt; {
                           console.log(location);
                           cb(<span style="color: #008b8b;">null</span>, require(<span style="color: #8b2252;">'./routes_rate'</span>).<span style="color: #a020f0;">default</span>);
                       }, <span style="color: #8b2252;">"routes_rate"</span>);
                }
               <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> (location.pathname.indexOf(<span style="color: #8b2252;">"/print"</span>) == 0) {
                   require.ensure([], require =&gt; {
                       console.log(location);
                       cb(<span style="color: #008b8b;">null</span>, require(<span style="color: #8b2252;">'./routes_print'</span>).<span style="color: #a020f0;">default</span>);
                   }, <span style="color: #8b2252;">"routes_print"</span>)
               }
           }
           }
    &gt;
        &lt;IndexRedirect from=<span style="color: #8b2252;">"/"</span> to=<span style="color: #8b2252;">"/trade"</span>/&gt;
    &lt;/Route&gt;
</pre>
</div>
<p>
3.上面require.ensure第三个参数，将取代webpack.config.js中配置的[name],<br />
如当第一次进入评价菜单，加载route_rate.chunk.js<br />
</p>
</div>
</div>
<div id="outline-container-org2505dfd" class="outline-3">
<h3 id="org2505dfd"><span class="todo TODO">TODO</span> 6.自动更新引用页中js，css版本</h3>
<div class="outline-text-3" id="text-org2505dfd">
</div>
</div>
<div id="outline-container-org6974acb" class="outline-3">
<h3 id="org6974acb"><span class="done DONE">DONE</span> 7.引用第三方js</h3>
<div class="outline-text-3" id="text-org6974acb">
<p>
原理：动态路由的同时，向head中写入&lt;script&gt;。实现了写入后再加载页面js功能。<br />
1.入口pages/root.html中增加一个window变量<br />
</p>
<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #b22222;">//</span><span style="color: #b22222;">&#24050;&#32463;&#24341;&#29992;&#36807;&#30340;&#31532;&#19977;&#26041;js&#65292;&#37117;&#25918;&#22312;build/external&#30446;&#24405;&#19979;&#65292;&#24341;&#29992;&#31532;&#19977;&#26041;js&#65292;css&#31561;&#65292;&#35843;&#29992;CommonJS.loadExternalFile(),&#20250;&#33258;&#21160;&#32500;&#25252;&#12290;</span>
window.externalJS = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Set</span>();
</pre>
</div>
<p>
2.routes控制时修改：<br />
</p>
<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #a020f0;">import</span> CommonJS from <span style="color: #8b2252;">'utils/common'</span>;
<span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> (location.pathname.indexOf(<span style="color: #8b2252;">"/rate"</span>) == 0) {
   {<span style="color: #b22222;">/*</span><span style="color: #b22222;">&#22914;&#26524;&#19981;&#38656;&#35201;&#24341;&#29992;&#31532;&#19977;&#26041;js&#65292;css,&#21017;&#30452;&#25509;require.ensure(...)*/</span>
   }
   CommonJS.loadExternalFile(<span style="color: #8b2252;">"jquery"</span>, <span style="color: #8b2252;">"../build/external/jquery-1.4.2.min.js?qntag=1"</span>, () =&gt; {
       require.ensure([], require =&gt; {
           console.log(location);
           cb(<span style="color: #008b8b;">null</span>, require(<span style="color: #8b2252;">'./routes_rate'</span>).<span style="color: #a020f0;">default</span>);
       }, <span style="color: #8b2252;">"routes_rate"</span>);
   });
}
</pre>
</div>
<p>
结果：<br />
</p>
<pre class="example">
index.js	200	script	index.js	67 B	15 ms
log.js	200	script	log.js	4.6 KB	16 ms
jquery-1.4.2.min.js?qntag=1	200	script	common.js:35	70.8 KB	6 ms
routes_rate.chunk.js	200	script	bootstrap 10caa08…:79	86.4 KB	4 ms
</pre>
</div>
</div>

<div id="outline-container-org44e1710" class="outline-3">
<h3 id="org44e1710"><span class="done DONE">DONE</span> 8.原框架使用webpack1.2,升级至最新版3.4</h3>
<div class="outline-text-3" id="text-org44e1710">
<p>
部分配置项可能有变更。<br />
</p>
</div>
</div>
<div id="outline-container-org8ead8b5" class="outline-3">
<h3 id="org8ead8b5"><span class="done DONE">DONE</span> 9.sass/scss样式相关</h3>
<div class="outline-text-3" id="text-org8ead8b5">
<p>
1./src/styles/_var.scss中定义了常用样式变量。尽量，或者一定使用统一变量。尤其是颜色值，设计那边已经给定色板，做到统一。<br />
2.使用上述变量方法：<br />
</p>
<pre class="example">
//scss文件顶部引入，不需要修改任何

@import "~styles/var";
background-color: $cbrand_common;
</pre>
<p>
3.不要引入任何带有普通样式的scss；否则最终打包的css样式会重复；所以变量单独存放在了_var.scss中。<br />
</p>
</div>

<div id="outline-container-orga049c3b" class="outline-4">
<h4 id="orga049c3b">禁止条例</h4>
<div class="outline-text-4" id="text-orga049c3b">
<p>
1.凡是scss文件顶层的样式，会作用于所有页面。所以，自己的样式，一定放在方法顶层div样式内.className按照菜单路径逐级，避免重复。<br />
</p>
<pre class="example">
render(&lt;div className="rateDefendSet-page"&gt;&lt;/div&gt;);

//scss文件，只包含一个顶层
.rateDefendSet-page{
    ...自己的所有样式
}

</pre>

<p>
2.如果通用样式，使用公共组件，或者添加自定义类。<br />
禁止出现类似下面这种，完全是QNUI的样式，直接修改的情况。否则样式由影响时很难查找到底是哪里使用的。<br />
(首页右上角个人中心浮框)<br />
</p>
<pre class="example">
&lt;Balloon ...

// 隐藏掉balloon外面三角
.next-balloon-normal.next-balloon-top:after {
    display: none !important;
}
</pre>
<p>
建议用法：<br />
</p>
<pre class="example">
&lt;Balloon className="lcdt"

// 隐藏掉balloon外面三角
.lcdt.next-balloon-normal.next-balloon-top:after {
    display: none !important;
}

</pre>
<p>
或者父元素增加class，与css类选择器同理。<br />
</p>
<pre class="example">
&lt;div className="myClass"&gt;
    &lt;Component

.myClass .next-xxx{
    ...
}

</pre>
</div>
</div>
</div>
<div id="outline-container-org7d4999c" class="outline-3">
<h3 id="org7d4999c"><span class="done DONE">DONE</span> 10.根据窗口大小动态设置主页滚动条高度，避免顶级菜单右侧出现滚动条</h3>
<div class="outline-text-3" id="text-org7d4999c">
<p>
见/src/layout/RootLayout文件夹<br />
</p>
<pre class="example">
handleResize = () =&gt; {
        this.setState({
            clientHeight: document.documentElement.clientHeight,
        })
    }

    componentDidMount() {
        this.setState({
            clientHeight: document.documentElement.clientHeight,
        })
        window.addEventListener("resize", this.handleResize);
    }

    render() {
        const headerHeight = 60;//顶级菜单高度，styles/_var.scss中定义。用于计算滚动窗口高度。
        let {folden} = this.state;
        return (
            &lt;div className="rootLayout-container"&gt;
                &lt;Header /&gt;
                &lt;div className="main-content" style={{height: `${this.state.clientHeight - headerHeight}px`}}&gt;
                    {this.props.children}
                &lt;/div&gt;
            &lt;/div&gt;
        );
    }
样式：
.rootLayout-container {
    width: 100%;
    height: 100%;
    overflow: hidden;
    .main-content {
        width: 100%;
        overflow: auto;
        position: absolute;
        top: $headerHeight;
    }
}
</pre>
</div>
</div>
<div id="outline-container-org1debe24" class="outline-3">
<h3 id="org1debe24"><span class="done DONE">DONE</span> 11.使用lodash &amp; 只导出引用的方法。</h3>
<div class="outline-text-3" id="text-org1debe24">
<p>
0.资料：<a href="https://lodash.com/docs/4.17.4">lodash 4.17.4</a> <a href="http://www.css88.com/doc/lodash/">lodash 4.16.1中文版</a><br />
1.安装：cnpm i &#x2013;save lodash<br />
或更新svn:package.json,执行cnpm i<br />
2.用法：import _ from "lodash";<br />
3.使用lodash-webpack-plugin实现最终js只包含引用到的方法，而不需要70多k都引入<br />
具体见webpack.config.js<br />
</p>
</div>
<div id="outline-container-org4bf8b03" class="outline-4">
<h4 id="org4bf8b03">_.get(object, path, [defaultValue]) 避免多层取值时中间出现null或undefined</h4>
</div>
<div id="outline-container-org1e61be7" class="outline-4">
<h4 id="org1e61be7">_.cloneDeep(value) 深度克隆</h4>
</div>
</div>

<div id="outline-container-org6d0edf4" class="outline-3">
<h3 id="org6d0edf4"><span class="done DONE">DONE</span> 12. ！Important：使用_.get(object, path, [defaultValue]) 避免多层取值时出现null或undefined</h3>
<div class="outline-text-3" id="text-org6d0edf4">
<p>
常见异常原因是多层嵌套取值时，中间某个值为null或undefined，而一个个去判断又很麻烦，所以这里单独提出来，增加我们系统的健壮性。用法：<br />
</p>

<p>
import _ from "lodash";<br />
</p>

<p>
var object = { 'a': [{ 'b': { 'c': 3 } }] };<br />
_.get(object, 'a[0].b.c');<br />
// =&gt; 3<br />
_.get(object, ['a', '0', 'b', 'c']);<br />
// =&gt; 3<br />
_.get(object, 'a.b.c', 'default');<br />
// =&gt; 'default'<br />
</p>
</div>
</div>
<div id="outline-container-org65903e0" class="outline-3">
<h3 id="org65903e0"><span class="done DONE">DONE</span> 13.开发阶段通过配置proxy实现ajax跨域</h3>
<div class="outline-text-3" id="text-org65903e0">
<p>
只需关注前两步中标注TODO的部分。<br />
1./src/utils/apimap.js<br />
</p>
<pre class="example">
//TODO 根据开发环境还是生产环境，选择性注释
export const _API_HOST = "/api";//与webpack.config.js中devServer部分配置的"/api"部分对应。
// export const _API_HOST = "https://puyunsoft.com";

export default{
    //TODO 需要维护的内容
    findBlackList: _API_HOST + "/pc/negativeInterceptAction!findBadBuyerBlackList.action",

}
</pre>
<p>
2./src/pages/root/actions/xxx.js<br />
</p>
<pre class="example">
import {ajax, nameSpace} from 'utils/index';
import apis from 'utils/apimap';

ajax({
    api: apis.findBlackList, //TODO 选用自己需要的接口
    method: 'GET',
}).then(json =&gt; {
    console.log(json);
    //成功后
    dispatch({
        type: REQUEST_SUCCESS,
        data: json.data
    });
}
</pre>
<p>
3.utils/index.js, 调用组件执行请求.不需要动.<br />
</p>
<pre class="example">
var Tools = {
    ajax: function (param, suc, err) {
        param.url =param.api;           // 如2,外层统一使用api,实际需要的是url.(使用api仅仅是延续,无任何特殊意义)
        param.type = 'json';
        var startTime = new Date().getTime();
        return reqwest(param).then((res) =&gt; {
</pre>

<p>
4.webpack.config.js核心配置:新增proxy配置<br />
</p>
<pre class="example">
// 发布状态
if (!DEV) {
} else {
    config.devServer = {
        headers: {'Access-Control-Allow-Origin': '*'},
        proxy: {
            //自动将                 /api/package/action!function.action转化为
            //      http://127.0.0.1:7001/package/action!function.action
            "/api": {
                target: "http://localhost:7001",
                pathRewrite: {
                    '^/api': ''
                }
            }
        }
        // 'Access-Control-Allow-Credentials': 'true'
    };
    config.plugins.push(new webpack.SourceMapDevToolPlugin({}));
}
</pre>
</div>
</div>
<div id="outline-container-org3a80821" class="outline-3">
<h3 id="org3a80821"><span class="done DONE">DONE</span> 13-1[优化]只代理以/pc开头，action结尾的地址</h3>
<div class="outline-text-3" id="text-org3a80821">
<p>
资料：<a href="https://github.com/chimurai/http-proxy-middleware#context-matching">http-proxy-middleware#context-matching</a><br />
配置：<br />
</p>
<pre class="example">
"/pc/**/*.action": {
    target: "http://192.168.1.88",
},
</pre>
<pre class="example">
export const _API_HOST = "";//不需要再区分开发还是生产环境，保存原地址不变。

findBlackList: _API_HOST + "/pc/negativeInterceptAction!findBadBuyerBlackList.action",
</pre>
<p>
(webpack-dev服务转发到weblogic服务)如地址<br />
127.0.0.1:9000/pc/negativeInterceptAction!findBadBuyerBlackList.action<br />
转化为<br />
192.168.1.88/pc/negativeInterceptAction!findBadBuyerBlackList.action<br />
</p>
</div>
</div>


<div id="outline-container-orge890abb" class="outline-3">
<h3 id="orge890abb"><span class="done DONE">DONE</span> 14.state 结合classnames 控制className</h3>
<div class="outline-text-3" id="text-orge890abb">
<p>
如下，根据this.state.xxx,控制是否className 是否包含hide:<br />
</p>
<pre class="example">
//component.js
import classnames from 'classnames';

let classnameCommon = classnames({
    commonRow: true,
    "hide": this.state.xxx ? true : false,
})
&lt;Component className="classnameCommon"/&gt;

//component.scss
.hide{
    xxx
}
</pre>
</div>
</div>
<div id="outline-container-org29ef621" class="outline-3">
<h3 id="org29ef621"><span class="done DONE">DONE</span> 15.获取ref="xx" 高度</h3>
<div class="outline-text-3" id="text-org29ef621">
<pre class="example">
import ReactDOM from 'react-dom';


handleClick=()=&gt;{
    let height = ReactDOM.findDOMNode(this.refs.xx).clientHeight;
}

render(){
    return(
        ...
        &lt;Component ref="xx"/&gt;
        ...        
    )
}
</pre>
</div>
</div>
<div id="outline-container-org50b8dae" class="outline-3">
<h3 id="org50b8dae"><span class="done DONE">DONE</span> 16.React Property initializers @author:薛念华</h3>
<div class="outline-text-3" id="text-org50b8dae">
<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #a020f0;">import</span> React, { Component , PropTypes} from <span style="color: #8b2252;">"react"</span>;

<span style="color: #a020f0;">class</span> TodoHeader <span style="color: #a020f0;">extends</span> Component {
    <span style="color: #a020f0;">static</span> get defaultProps() { <span style="color: #b22222;">//</span><span style="color: #b22222;">&#35774;&#32622;&#21021;&#22987;&#20540;&#65292;&#35843;&#29992;&#32452;&#20214;&#19981;&#20256;props&#65292;&#21017;&#20026;&#40664;&#35748;&#20540;</span>
        <span style="color: #a020f0;">return</span> {
            name:<span style="color: #8b2252;">"Json wu"</span>,
            count:25
        }
    }

    <span style="color: #a020f0;">static</span> propTypes = {        <span style="color: #b22222;">//</span><span style="color: #b22222;">&#21046;&#23450;&#31867;&#22411;&#65292;&#22914;&#26524;&#19981;&#31526;&#21512;&#20250;&#25253;&#38169;&#12290;</span>
        name:PropTypes.string.isRequired,
        count:PropTypes.number.isRequired
    };


    render() {
        <span style="color: #a020f0;">return</span> (
            &lt;div&gt;
                &lt;h2&gt;Hello,{<span style="color: #008b8b;">this</span>.props.name}&lt;/h2&gt;
                &lt;h3&gt;&#24744;&#26377;{<span style="color: #008b8b;">this</span>.props.count}&#39033;&#24453;&#21150;&#20107;&#39033;&#26410;&#22788;&#29702;&lt;/h3&gt;
            &lt;/div&gt;
        )
    }
}

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> TodoHeader;
</pre>
</div>
</div>
</div>
<div id="outline-container-org836fb5b" class="outline-3">
<h3 id="org836fb5b"><span class="done DONE">DONE</span> 17.React中key的重要性</h3>
<div class="outline-text-3" id="text-org836fb5b">
<p>
<a href="https://facebook.github.io/react/tutorial/tutorial.html#keys">Facebook-react: keys</a>:<br />
Keys tell React about the identity of each component, so that it can maintain the state across rerenders. If you change the key of a component, it will be completely destroyed and recreated with a new state.<br />
</p>

<p>
列表中元素往往知道用key，但下面情景，也需要用key。<br />
情景：快递单打印预览，&lt;Preview&gt;中嵌套&lt;View&gt;，用于显示快递单预览内容。<br />
点击上一个、下一个，更新&lt;View&gt;预览内容，此时，一定要设置不同的key！<br />
如下：<br />
</p>
<pre class="example">
&lt;Preview&gt;
    render(){
        ...
        &lt;View 
            order={orders[this.state.index-1]}
            index={this.state.index}
            template={this.state.template}
            key={this.state.index}
        /&gt;

&lt;a href="javascript:void(0);" className="rowElement" onClick={() =&gt; {
    if (this.state.index != 1) {
        this.setState({
            index: this.state.index - 1,
        })
    }
}}&gt;上一个&lt;/a&gt;
&lt;span className="rowElement"&gt;{this.state.index} / {orders.length}&lt;/span&gt;
&lt;a href="javascript:void(0);" onClick={() =&gt; {
    if (this.state.index != orders.length) {
        this.setState({
            index: this.state.index + 1,
        })
    }
}}&gt;下一个&lt;/a&gt;   
        ...
    }
&lt;/Preview&gt;

</pre>
</div>
</div>

<div id="outline-container-org97ffaae" class="outline-3">
<h3 id="org97ffaae"><span class="done DONE">DONE</span> 18.函数式编程 参考</h3>
<div class="outline-text-3" id="text-org97ffaae">
<p>
<a href="https://zhuanlan.zhihu.com/p/26174525">React世界的函数式编程(Functional Programming)</a><br />
<a href="https://justclear.gitlab.io/functional-in-react/">React 中的函数式思想</a><br />
</p>
</div>
</div>
</div>
</div>
</body>
</html>
